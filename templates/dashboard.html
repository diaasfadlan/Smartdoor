<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smartdoor Dashboard</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #1e1b29;
            color: white;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        .navbar {
            background: #3a275f;
            padding: 14px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Chat Bubble */
        .bubble {
            background: #2d2349;
            border-radius: 10px;
            padding: 10px;
            max-width: 80%;
            display: flex;
            flex-direction: column;
            gap: 6px;
            box-shadow: 0 0 5px rgba(255,255,255,0.1);
            animation: fadeIn .4s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bubble img {
            width: 200px;
            border-radius: 8px;
        }

        .status {
            font-size: 14px;
            color: #a2b5ff;
            font-weight: bold;
        }

        .time {
            font-size: 12px;
            text-align: right;
            opacity: .8;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb {
            background: #4a3a6f;
            border-radius: 4px;
        }
    </style>

    <script>
        let lastCount = {{ logs|length }};
        
        function checkUpdate() {
            fetch('/dashboard_check')
                .then(res => res.json())
                .then(data => {
                    if (data.count > lastCount) {
                        lastCount = data.count;
                        playNotif();
                        location.reload();
                    }
                });
        }

        function playNotif() {
            const audio = new Audio("https://notificationsounds.com/storage/sounds/file-sounds-1151-pristine.mp3");
            audio.play();
            alert("ðŸ”” Data baru diterima!");
        }

        setInterval(checkUpdate, 5000); // Check tiap 5 detik
    </script>

</head>
<body>

<div class="navbar">Smartdoor</div>

<div class="chat-container" id="chatBox">
    {% for log in logs %}
    <div class="bubble">
        {% if log.image %}
            <img src="data:image/jpeg;base64,{{ log.image }}">
        {% endif %}
        <span class="status">Status: {{ log.status }}</span>
        <span class="time">{{ log.time }}</span>
    </div>
    {% endfor %}
</div>

<script>
    // Auto scroll ke bawah (like WhatsApp)
    const chatBox = document.getElementById("chatBox");
    chatBox.scrollTop = chatBox.scrollHeight;
</script>

</body>
</html>
